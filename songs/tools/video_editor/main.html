<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频JSON编辑器</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .frame-item, .macro-item, .super-object-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            position: relative;
        }
        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background-color: #c0392b;
        }
        .object-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 3px;
        }
        .tab-container {
            margin-top: 20px;
        }
        .tab-buttons {
            display: flex;
            margin-bottom: 10px;
        }
        .tab-button {
            padding: 10px 20px;
            background-color: #ddd;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab-button.active {
            background-color: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 0 5px 5px 5px;
        }
        .tab-content.active {
            display: block;
        }
        .color-preview {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 1px solid #ddd;
            vertical-align: middle;
            margin-left: 10px;
        }
        .preview-area {
            margin-top: 20px;
            padding: 15px;
            border: 1px dashed #ccc;
            background-color: #fafafa;
            min-height: 200px;
            position: relative;
        }
        .preview-text {
            position: absolute;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>视频JSON编辑器</h1>
        
        <div class="section">
            <h2>基本设置</h2>
            <div class="form-group">
                <label for="version">版本号:</label>
                <input type="text" id="version" value="0.0.24">
            </div>
            <div class="form-group">
                <label for="description">描述:</label>
                <input type="text" id="description" value="胖橘的人生感悟-治愈人的话">
            </div>
            <div class="form-group">
                <label for="width">宽度:</label>
                <input type="number" id="width" value="1024">
            </div>
            <div class="form-group">
                <label for="height">高度:</label>
                <input type="number" id="height" value="768">
            </div>
            <div class="form-group">
                <label for="music">背景音乐URL:</label>
                <input type="text" id="music" value="https://jeremyjia.github.io/Corpus/songs/mp3/6v.mp3">
            </div>
            <div class="form-group">
                <label for="duration">持续时间(秒):</label>
                <input type="text" id="duration" value="(36,120)">
            </div>
            <div class="form-group">
                <label for="rate">速率:</label>
                <input type="text" id="rate" value="1">
            </div>
        </div>

        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="frames">帧设置</button>
                <button class="tab-button" data-tab="superObjects">超级对象</button>
                <button class="tab-button" data-tab="macros">宏定义</button>
                <button class="tab-button" data-tab="preview">预览</button>
            </div>

            <div id="frames" class="tab-content active">
                <h2>帧设置</h2>
                <button id="add-frame-btn">添加帧</button>
                <div id="frames-container"></div>
            </div>

            <div id="superObjects" class="tab-content">
                <h2>超级对象</h2>
                <button id="add-super-object-btn">添加超级对象</button>
                <div id="super-objects-container"></div>
            </div>

            <div id="macros" class="tab-content">
                <h2>宏定义</h2>
                <button id="add-macro-btn">添加宏</button>
                <div id="macros-container"></div>
            </div>

            <div id="preview" class="tab-content">
                <h2>JSON预览</h2>
                <button id="generate-json-btn">生成JSON</button>
                <button id="load-json-btn">加载JSON</button>
                <input type="file" id="json-file" style="display: none;">
                <pre id="json-preview" style="white-space: pre-wrap; word-wrap: break-word; background-color: #f5f5f5; padding: 10px; border-radius: 5px; max-height: 500px; overflow-y: auto;"></pre>
                
                <h2>效果预览</h2>
                <div class="preview-area" id="preview-area" style="width: 1024px; height: 768px;"></div>
            </div>
        </div>
    </div>

    <script>
        // 初始数据
        let videoData = {
            request: {
                version: "0.0.24",
                description: "胖橘的人生感悟-治愈人的话",
                width: 1024,
                height: 768,
                music: "https://jeremyjia.github.io/Corpus/songs/mp3/6v.mp3",
                duration: "(36,120)",
                rate: "1",
                frames: [],
                superObjects: [],
                Macros: []
            }
        };

        // 初始化UI
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化标签页
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 移除所有active类
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 添加active类到当前标签
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // 基本设置表单事件
            document.getElementById('version').addEventListener('change', updateBasicSettings);
            document.getElementById('description').addEventListener('change', updateBasicSettings);
            document.getElementById('width').addEventListener('change', updateBasicSettings);
            document.getElementById('height').addEventListener('change', updateBasicSettings);
            document.getElementById('music').addEventListener('change', updateBasicSettings);
            document.getElementById('duration').addEventListener('change', updateBasicSettings);
            document.getElementById('rate').addEventListener('change', updateBasicSettings);

            function updateBasicSettings() {
                videoData.request.version = document.getElementById('version').value;
                videoData.request.description = document.getElementById('description').value;
                videoData.request.width = parseInt(document.getElementById('width').value);
                videoData.request.height = parseInt(document.getElementById('height').value);
                videoData.request.music = document.getElementById('music').value;
                videoData.request.duration = document.getElementById('duration').value;
                videoData.request.rate = document.getElementById('rate').value;
                updatePreview();
            }

            // 添加帧按钮
            document.getElementById('add-frame-btn').addEventListener('click', function() {
                const newFrame = {
                    time: 4,
                    objects: [],
                    backgroundPicture: ""
                };
                videoData.request.frames.push(newFrame);
                renderFrame(videoData.request.frames.length - 1);
                updatePreview();
            });

            // 添加超级对象按钮
            document.getElementById('add-super-object-btn').addEventListener('click', function() {
                const newSuperObject = {
                    type: "text",
                    attribute: {
                        x1: 20,
                        y1: 300,
                        x2: -1,
                        y2: -1,
                        size: 30,
                        color: "138,43,226",
                        name: "",
                        area: {
                            left: 150,
                            top: 350,
                            width: 800,
                            height: 150
                        }
                    },
                    layer: 2,
                    frameRange: "(42,300)",
                    action: {
                        trace: "x=380",
                        step: -10
                    }
                };
                videoData.request.superObjects.push(newSuperObject);
                renderSuperObject(videoData.request.superObjects.length - 1);
                updatePreview();
            });

            // 添加宏按钮
            document.getElementById('add-macro-btn').addEventListener('click', function() {
                const newMacro = {
                    name: "",
                    value: ""
                };
                videoData.request.Macros.push(newMacro);
                renderMacro(videoData.request.Macros.length - 1);
                updatePreview();
            });

            // 生成JSON按钮
            document.getElementById('generate-json-btn').addEventListener('click', function() {
                updatePreview();
                document.getElementById('json-preview').textContent = JSON.stringify(videoData, null, 2);
                
                // 创建下载链接
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(videoData, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "video_config.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            });

            // 加载JSON按钮
            document.getElementById('load-json-btn').addEventListener('click', function() {
                document.getElementById('json-file').click();
            });

            document.getElementById('json-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        videoData = jsonData;
                        loadDataToUI();
                        updatePreview();
                    } catch (error) {
                        alert("解析JSON文件出错: " + error.message);
                    }
                };
                reader.readAsText(file);
            });

            // 渲染所有帧
            function renderFrames() {
                const container = document.getElementById('frames-container');
                container.innerHTML = '';
                videoData.request.frames.forEach((frame, index) => {
                    renderFrame(index);
                });
            }

            // 渲染单个帧
            function renderFrame(index) {
                const frame = videoData.request.frames[index];
                const container = document.getElementById('frames-container');
                
                const frameElement = document.createElement('div');
                frameElement.className = 'frame-item';
                frameElement.innerHTML = `
                    <h3>帧 #${index + 1}</h3>
                    <button class="remove-btn" data-index="${index}">删除</button>
                    <div class="form-group">
                        <label for="frame-time-${index}">时间(秒):</label>
                        <input type="number" id="frame-time-${index}" value="${frame.time}" data-index="${index}" class="frame-time">
                    </div>
                    <div class="form-group">
                        <label for="frame-bg-${index}">背景图片:</label>
                        <input type="text" id="frame-bg-${index}" value="${frame.backgroundPicture}" data-index="${index}" class="frame-bg">
                    </div>
                    <h4>对象列表</h4>
                    <button class="add-object-btn" data-frame-index="${index}">添加对象</button>
                    <div class="objects-container" id="objects-container-${index}"></div>
                `;
                
                container.appendChild(frameElement);
                
                // 添加删除帧事件
                frameElement.querySelector('.remove-btn').addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.frames.splice(index, 1);
                    renderFrames();
                    updatePreview();
                });
                
                // 添加帧时间更改事件
                frameElement.querySelector('.frame-time').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.frames[index].time = parseInt(this.value);
                    updatePreview();
                });
                
                // 添加背景图片更改事件
                frameElement.querySelector('.frame-bg').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.frames[index].backgroundPicture = this.value;
                    updatePreview();
                });
                
                // 添加对象按钮事件
                frameElement.querySelector('.add-object-btn').addEventListener('click', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const newObject = {
                        text: "",
                        x: 100,
                        y: 100,
                        size: 30,
                        color: "0,0,0",
                        layer: 1
                    };
                    videoData.request.frames[frameIndex].objects.push(newObject);
                    renderObject(frameIndex, videoData.request.frames[frameIndex].objects.length - 1);
                    updatePreview();
                });
                
                // 渲染所有对象
                const objectsContainer = frameElement.querySelector('.objects-container');
                frame.objects.forEach((obj, objIndex) => {
                    renderObject(index, objIndex);
                });
            }

            // 渲染单个对象
            function renderObject(frameIndex, objIndex) {
                const obj = videoData.request.frames[frameIndex].objects[objIndex];
                const container = document.getElementById(`objects-container-${frameIndex}`);
                
                const objElement = document.createElement('div');
                objElement.className = 'object-item';
                objElement.innerHTML = `
                    <button class="remove-object-btn" data-frame-index="${frameIndex}" data-obj-index="${objIndex}">删除</button>
                    <div class="form-group">
                        <label for="obj-text-${frameIndex}-${objIndex}">文本:</label>
                        <textarea id="obj-text-${frameIndex}-${objIndex}" data-frame-index="${frameIndex}" data-obj-index="${objIndex}" class="obj-text">${obj.text}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="obj-x-${frameIndex}-${objIndex}">X位置:</label>
                        <input type="number" id="obj-x-${frameIndex}-${objIndex}" value="${obj.x}" data-frame-index="${frameIndex}" data-obj-index="${objIndex}" class="obj-x">
                    </div>
                    <div class="form-group">
                        <label for="obj-y-${frameIndex}-${objIndex}">Y位置:</label>
                        <input type="number" id="obj-y-${frameIndex}-${objIndex}" value="${obj.y}" data-frame-index="${frameIndex}" data-obj-index="${objIndex}" class="obj-y">
                    </div>
                    <div class="form-group">
                        <label for="obj-size-${frameIndex}-${objIndex}">字体大小:</label>
                        <input type="number" id="obj-size-${frameIndex}-${objIndex}" value="${obj.size}" data-frame-index="${frameIndex}" data-obj-index="${objIndex}" class="obj-size">
                    </div>
                    <div class="form-group">
                        <label for="obj-color-${frameIndex}-${objIndex}">颜色(R,G,B):</label>
                        <input type="text" id="obj-color-${frameIndex}-${objIndex}" value="${obj.color}" data-frame-index="${frameIndex}" data-obj-index="${objIndex}" class="obj-color">
                        <div class="color-preview" style="background-color: rgb(${obj.color})"></div>
                    </div>
                    <div class="form-group">
                        <label for="obj-layer-${frameIndex}-${objIndex}">图层:</label>
                        <input type="number" id="obj-layer-${frameIndex}-${objIndex}" value="${obj.layer}" data-frame-index="${frameIndex}" data-obj-index="${objIndex}" class="obj-layer">
                    </div>
                `;
                
                container.appendChild(objElement);
                
                // 添加删除对象事件
                objElement.querySelector('.remove-object-btn').addEventListener('click', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const objIndex = parseInt(this.getAttribute('data-obj-index'));
                    videoData.request.frames[frameIndex].objects.splice(objIndex, 1);
                    renderFrames();
                    updatePreview();
                });
                
                // 添加对象属性更改事件
                objElement.querySelector('.obj-text').addEventListener('change', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const objIndex = parseInt(this.getAttribute('data-obj-index'));
                    videoData.request.frames[frameIndex].objects[objIndex].text = this.value;
                    updatePreview();
                });
                
                objElement.querySelector('.obj-x').addEventListener('change', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const objIndex = parseInt(this.getAttribute('data-obj-index'));
                    videoData.request.frames[frameIndex].objects[objIndex].x = parseInt(this.value);
                    updatePreview();
                });
                
                objElement.querySelector('.obj-y').addEventListener('change', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const objIndex = parseInt(this.getAttribute('data-obj-index'));
                    videoData.request.frames[frameIndex].objects[objIndex].y = parseInt(this.value);
                    updatePreview();
                });
                
                objElement.querySelector('.obj-size').addEventListener('change', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const objIndex = parseInt(this.getAttribute('data-obj-index'));
                    videoData.request.frames[frameIndex].objects[objIndex].size = parseInt(this.value);
                    updatePreview();
                });
                
                objElement.querySelector('.obj-color').addEventListener('change', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const objIndex = parseInt(this.getAttribute('data-obj-index'));
                    videoData.request.frames[frameIndex].objects[objIndex].color = this.value;
                    this.nextElementSibling.style.backgroundColor = `rgb(${this.value})`;
                    updatePreview();
                });
                
                objElement.querySelector('.obj-layer').addEventListener('change', function() {
                    const frameIndex = parseInt(this.getAttribute('data-frame-index'));
                    const objIndex = parseInt(this.getAttribute('data-obj-index'));
                    videoData.request.frames[frameIndex].objects[objIndex].layer = parseInt(this.value);
                    updatePreview();
                });
            }

            // 渲染所有超级对象
            function renderSuperObjects() {
                const container = document.getElementById('super-objects-container');
                container.innerHTML = '';
                videoData.request.superObjects.forEach((superObj, index) => {
                    renderSuperObject(index);
                });
            }

            // 渲染单个超级对象
            function renderSuperObject(index) {
                const superObj = videoData.request.superObjects[index];
                const container = document.getElementById('super-objects-container');
                
                const superObjElement = document.createElement('div');
                superObjElement.className = 'super-object-item';
                superObjElement.innerHTML = `
                    <h3>超级对象 #${index + 1}</h3>
                    <button class="remove-btn" data-index="${index}">删除</button>
                    <div class="form-group">
                        <label for="super-obj-type-${index}">类型:</label>
                        <select id="super-obj-type-${index}" data-index="${index}" class="super-obj-type">
                            <option value="text" ${superObj.type === 'text' ? 'selected' : ''}>文本</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="super-obj-layer-${index}">图层:</label>
                        <input type="number" id="super-obj-layer-${index}" value="${superObj.layer}" data-index="${index}" class="super-obj-layer">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-frame-range-${index}">帧范围:</label>
                        <input type="text" id="super-obj-frame-range-${index}" value="${superObj.frameRange}" data-index="${index}" class="super-obj-frame-range">
                    </div>
                    <h4>属性</h4>
                    <div class="form-group">
                        <label for="super-obj-x1-${index}">X1:</label>
                        <input type="number" id="super-obj-x1-${index}" value="${superObj.attribute.x1}" data-index="${index}" class="super-obj-x1">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-y1-${index}">Y1:</label>
                        <input type="number" id="super-obj-y1-${index}" value="${superObj.attribute.y1}" data-index="${index}" class="super-obj-y1">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-x2-${index}">X2:</label>
                        <input type="number" id="super-obj-x2-${index}" value="${superObj.attribute.x2}" data-index="${index}" class="super-obj-x2">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-y2-${index}">Y2:</label>
                        <input type="number" id="super-obj-y2-${index}" value="${superObj.attribute.y2}" data-index="${index}" class="super-obj-y2">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-size-${index}">字体大小:</label>
                        <input type="number" id="super-obj-size-${index}" value="${superObj.attribute.size}" data-index="${index}" class="super-obj-size">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-color-${index}">颜色(R,G,B):</label>
                        <input type="text" id="super-obj-color-${index}" value="${superObj.attribute.color}" data-index="${index}" class="super-obj-color">
                        <div class="color-preview" style="background-color: rgb(${superObj.attribute.color})"></div>
                    </div>
                    <div class="form-group">
                        <label for="super-obj-name-${index}">文本内容:</label>
                        <textarea id="super-obj-name-${index}" data-index="${index}" class="super-obj-name">${superObj.attribute.name}</textarea>
                    </div>
                    <h4>区域</h4>
                    <div class="form-group">
                        <label for="super-obj-area-left-${index}">Left:</label>
                        <input type="number" id="super-obj-area-left-${index}" value="${superObj.attribute.area.left}" data-index="${index}" class="super-obj-area-left">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-area-top-${index}">Top:</label>
                        <input type="number" id="super-obj-area-top-${index}" value="${superObj.attribute.area.top}" data-index="${index}" class="super-obj-area-top">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-area-width-${index}">Width:</label>
                        <input type="number" id="super-obj-area-width-${index}" value="${superObj.attribute.area.width}" data-index="${index}" class="super-obj-area-width">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-area-height-${index}">Height:</label>
                        <input type="number" id="super-obj-area-height-${index}" value="${superObj.attribute.area.height}" data-index="${index}" class="super-obj-area-height">
                    </div>
                    <h4>动作</h4>
                    <div class="form-group">
                        <label for="super-obj-trace-${index}">轨迹:</label>
                        <input type="text" id="super-obj-trace-${index}" value="${superObj.action.trace}" data-index="${index}" class="super-obj-trace">
                    </div>
                    <div class="form-group">
                        <label for="super-obj-step-${index}">步长:</label>
                        <input type="number" id="super-obj-step-${index}" value="${superObj.action.step}" data-index="${index}" class="super-obj-step">
                    </div>
                `;
                
                container.appendChild(superObjElement);
                
                // 添加删除超级对象事件
                superObjElement.querySelector('.remove-btn').addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects.splice(index, 1);
                    renderSuperObjects();
                    updatePreview();
                });
                
                // 添加超级对象属性更改事件
                superObjElement.querySelector('.super-obj-type').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].type = this.value;
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-layer').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].layer = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-frame-range').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].frameRange = this.value;
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-x1').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.x1 = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-y1').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.y1 = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-x2').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.x2 = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-y2').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.y2 = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-size').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.size = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-color').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.color = this.value;
                    this.nextElementSibling.style.backgroundColor = `rgb(${this.value})`;
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-name').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.name = this.value;
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-area-left').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.area.left = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-area-top').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.area.top = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-area-width').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.area.width = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-area-height').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].attribute.area.height = parseInt(this.value);
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-trace').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].action.trace = this.value;
                    updatePreview();
                });
                
                superObjElement.querySelector('.super-obj-step').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.superObjects[index].action.step = parseInt(this.value);
                    updatePreview();
                });
            }

            // 渲染所有宏
            function renderMacros() {
                const container = document.getElementById('macros-container');
                container.innerHTML = '';
                videoData.request.Macros.forEach((macro, index) => {
                    renderMacro(index);
                });
            }

            // 渲染单个宏
            function renderMacro(index) {
                const macro = videoData.request.Macros[index];
                const container = document.getElementById('macros-container');
                
                const macroElement = document.createElement('div');
                macroElement.className = 'macro-item';
                macroElement.innerHTML = `
                    <h3>宏 #${index + 1}</h3>
                    <button class="remove-btn" data-index="${index}">删除</button>
                    <div class="form-group">
                        <label for="macro-name-${index}">名称:</label>
                        <input type="text" id="macro-name-${index}" value="${macro.name}" data-index="${index}" class="macro-name">
                    </div>
                    <div class="form-group">
                        <label for="macro-value-${index}">值:</label>
                        <input type="text" id="macro-value-${index}" value="${macro.value}" data-index="${index}" class="macro-value">
                    </div>
                `;
                
                container.appendChild(macroElement);
                
                // 添加删除宏事件
                macroElement.querySelector('.remove-btn').addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.Macros.splice(index, 1);
                    renderMacros();
                    updatePreview();
                });
                
                // 添加宏属性更改事件
                macroElement.querySelector('.macro-name').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.Macros[index].name = this.value;
                    updatePreview();
                });
                
                macroElement.querySelector('.macro-value').addEventListener('change', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    videoData.request.Macros[index].value = this.value;
                    updatePreview();
                });
            }

            // 更新预览
            function updatePreview() {
                document.getElementById('json-preview').textContent = JSON.stringify(videoData, null, 2);
                updateVisualPreview();
            }

            // 更新可视化预览
            function updateVisualPreview() {
                const previewArea = document.getElementById('preview-area');
                previewArea.innerHTML = '';
                
                // 设置预览区域大小
                previewArea.style.width = `${videoData.request.width}px`;
                previewArea.style.height = `${videoData.request.height}px`;
                
                // 如果有帧，显示第一帧的内容
                if (videoData.request.frames.length > 0) {
                    const firstFrame = videoData.request.frames[0];
                    
                    // 显示背景图片（模拟）
                    if (firstFrame.backgroundPicture) {
                        const bgImg = document.createElement('div');
                        bgImg.style.position = 'absolute';
                        bgImg.style.top = '0';
                        bgImg.style.left = '0';
                        bgImg.style.width = '100%';
                        bgImg.style.height = '100%';
                        bgImg.style.backgroundColor = '#ddd';
                        bgImg.style.display = 'flex';
                        bgImg.style.alignItems = 'center';
                        bgImg.style.justifyContent = 'center';
                        bgImg.textContent = `背景: ${firstFrame.backgroundPicture}`;
                        previewArea.appendChild(bgImg);
                    }
                    
                    // 显示文本对象
                    firstFrame.objects.forEach(obj => {
                        const textElement = document.createElement('div');
                        textElement.className = 'preview-text';
                        textElement.textContent = obj.text;
                        textElement.style.left = `${obj.x}px`;
                        textElement.style.top = `${obj.y}px`;
                        textElement.style.fontSize = `${obj.size}px`;
                        textElement.style.color = `rgb(${obj.color})`;
                        textElement.style.whiteSpace = 'pre';
                        previewArea.appendChild(textElement);
                    });
                }
            }

            // 加载数据到UI
            function loadDataToUI() {
                // 基本设置
                document.getElementById('version').value = videoData.request.version;
                document.getElementById('description').value = videoData.request.description;
                document.getElementById('width').value = videoData.request.width;
                document.getElementById('height').value = videoData.request.height;
                document.getElementById('music').value = videoData.request.music;
                document.getElementById('duration').value = videoData.request.duration;
                document.getElementById('rate').value = videoData.request.rate;
                
                // 渲染各部分
                renderFrames();
                renderSuperObjects();
                renderMacros();
                
                // 更新预览
                updatePreview();
            }

            // 初始加载示例数据
            const exampleData = {
  "request": {
    "version": "0.0.24",
    "description": "胖橘的人生感悟-治愈人的话",
    "width": 1024,
    "height": 768,
    "music": "https://jeremyjia.github.io/Corpus/songs/mp3/6v.mp3",
    "duration": "(36,120)",
    "rate": "1",
    "frames": [
      {
        "time": 4,
        "objects": [
          {
            "text": "有的人\n四十岁就去世了",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "40,20,10",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_1}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "有的人\n五十岁也走了",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "30,130,200",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_2}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "所以你一定要明白",
            "x": 120,
            "y": 200,
            "size": 60,
            "color": "0,0,20",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_3}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "我们不是\n等到老了才会死",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "34,139,34",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_4}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "而是随时随地\n都有可能会死",
            "x": 120,
            "y": 150,
            "size": 60,
            "color": "160,32,240",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_5}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "其实大部分的人生\n都没有任何意义",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "0,130,130",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_6}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "百年之后时间会\n抹平你所有\n存在过的痕迹",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "0,0,0",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_7}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "所以人生\n更多的意义",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "255,0,255",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_8}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "就是来到这个世界\n几十年的体验",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "0,0,0",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_9}"
      },
      {
        "time": 4,
        "objects": [
          {
            "text": "不要让不开心\n充斥着短暂的人生",
            "x": 120,
            "y": 100,
            "size": 60,
            "color": "255,185,15",
            "layer": 2
          }
        ],
        "backgroundPicture": "${VAR_PIC_10}"
      },
      {
        "time": 26,
        "objects": [
          {
            "text": "看看胖橘的人生态度",
            "x": 220,
            "y": 100,
            "size": 60,
            "color": "0,238,238",
            "layer": 2
          }
        ],
        "backgroundPicture": "catpaper.png"
      }
    ],
    "superObjects": [
      {
        "type": "text",
        "attribute": {
          "x1": 20,
          "y1": 300,
          "x2": -1,
          "y2": -1,
          "size": 30,
          "color": "138,43,226",
          "name": "用心去品尝每一口饭菜\n尽情去欣赏每一处风景\n勇敢的去热爱生活\n人生匆匆就过去了\n这个世界\n我们只来一次\n玩一玩就走了\n什么财富\n什么面子\n其实都没有那么重要\n请珍惜好\n你活着的\n每一天",
          "area": {
            "left": 150,
            "top": 350,
            "width": 800,
            "height": 150
          }
        },
        "layer": 2,
        "frameRange": "(42,300)",
        "action": {
          "trace": "x=380",
          "step": -10
        }
      }
    ],
    "Macros": [
      {
        "name": "VAR_PIC_1",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat1.png"
      },
      {
        "name": "VAR_PIC_2",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat2.png"
      },
      {
        "name": "VAR_PIC_3",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat3.png"
      },
      {
        "name": "VAR_PIC_4",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat4.png"
      },
      {
        "name": "VAR_PIC_5",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat5.png"
      },
      {
        "name": "VAR_PIC_6",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat6.png"
      },
      {
        "name": "VAR_PIC_7",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat7.png"
      },
      {
        "name": "VAR_PIC_8",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat8.png"
      },
      {
        "name": "VAR_PIC_9",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat9.png"
      },
      {
        "name": "VAR_PIC_10",
        "value": "https://jeremyjia.github.io/Corpus/songs/pic/cat/fat10.png"
      }
    ]
  }
};
            
            videoData = exampleData;
            loadDataToUI();
        });
    </script>
</body>
</html>